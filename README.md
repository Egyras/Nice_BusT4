# Nice Bus T4
Nice Bus T4 protocol

Появилось желание разобраться в протоколе для управления воротами Nice.
Переспектива - дешёвые устройства на базе esp8266 с вебсервером, для управлением из умного дома.

Современные блоки управления приводами имеют разъем BusT4, на который выведены GND, +24V, Can-Rx, Can-Tx. 

Что знаю про BusT4:

Это измененный UART 19200 8n1 с uart.break длительностью 519us-590us перед каждым пакетом.
Можно подключать несколько устройств.
Физическая передача происходит через CAN трансиверы, но CAN-фреймов нет.

Что сделано:
Подключил FTDI232 к GND, Can-Rx, Can-Tx. UART обнаружен только в момент поступания команды в шину. Пакеты видны и поддаются расшифровке.
Логическим анализатором увидел форму сигнала и состав посылок, подобрал параметры uart.
Успешно имитировал считанный пакет через Arduino Mega, привод реагирует.
Получил команды OPEN CLOSE и тд
Получил байт статуса привода
Считал основные команды, частично расшифровал значение байт.

Что нужно сделать:
Создать ESPHOME компонент для управления приводами Nice.


ESP8266 не совпадает по уровню сигнала с BUS T4, добавить преобразователь уровней 3.3В -> 5В для Tx на транзисторе.
Rx ESP толерантен к 5В.

В бета версии компонента возможна отправка произвольной команды на привод через службу  ESPHome: nice_bust4_uart_raw_command в Home assystant.
SBS:  55 0c  00  03  00  81  01  05  86  01  82  01  64  e6  0c
Open: 55	0c	00	03	05	81	01	05	83	01	82	03	64	e4	0c
Close: 55	0c	00	03	05	81	01	05	83	01	82	04	64	e3	0c
Stop: 
